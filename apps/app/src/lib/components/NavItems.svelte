<script lang="ts">
	import WhisperingButton from '$lib/components/WhisperingButton.svelte';
	import { GithubIcon } from '$lib/components/icons';
	import { settings } from '$lib/stores/settings.svelte';
	import { cn } from '$lib/utils';
	import { LogicalSize, getCurrentWindow } from '@tauri-apps/api/window';
	import {
		LayersIcon,
		ListIcon,
		Minimize2Icon,
		MoonIcon,
		SlidersVerticalIcon,
		SunIcon,
	} from 'lucide-svelte';
	import { toggleMode } from 'mode-watcher';

	let { class: className }: { class?: string } = $props();

	const hasActiveTransformation = $derived(
		settings.value['transformations.selectedTransformationId'] !== null,
	);
</script>

<nav
	class={cn('flex items-center', className)}
	style="view-transition-name: nav"
>
	<WhisperingButton
		tooltipContent="Recordings"
		href="/recordings"
		variant="ghost"
		size="icon"
	>
		<ListIcon class="h-4 w-4" aria-hidden="true" />
	</WhisperingButton>
	<WhisperingButton
		tooltipContent="Transformations"
		href="/transformations"
		variant="ghost"
		size="icon"
		class="relative"
	>
		<LayersIcon class="h-4 w-4" aria-hidden="true" />
		{#if hasActiveTransformation}
			<span
				class="absolute -right-0.5 -top-0.5 h-2 w-2 rounded-full bg-primary before:absolute before:h-full before:w-full before:rounded-full before:bg-primary/50 before:animate-ping"
			></span>
		{/if}
	</WhisperingButton>
	<WhisperingButton
		tooltipContent="Settings"
		href="/settings"
		variant="ghost"
		size="icon"
	>
		<SlidersVerticalIcon class="h-4 w-4" aria-hidden="true" />
	</WhisperingButton>
	<WhisperingButton
		tooltipContent="View project on GitHub"
		href="https://github.com/braden-w/whispering"
		target="_blank"
		rel="noopener noreferrer"
		variant="ghost"
		size="icon"
	>
		<GithubIcon class="h-4 w-4" aria-hidden="true" />
	</WhisperingButton>
	<WhisperingButton
		tooltipContent="Toggle dark mode"
		onclick={toggleMode}
		variant="ghost"
		size="icon"
	>
		<SunIcon
			class="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"
		/>
		<MoonIcon
			class="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"
		/>
	</WhisperingButton>
	{#if window.__TAURI_INTERNALS__}
		<WhisperingButton
			tooltipContent="Minimize"
			onclick={() => getCurrentWindow().setSize(new LogicalSize(72, 84))}
			variant="ghost"
			size="icon"
		>
			<Minimize2Icon class="h-4 w-4" aria-hidden="true" />
		</WhisperingButton>
	{/if}
</nav>

<style>
	@keyframes ping {
		75%,
		100% {
			transform: scale(2);
			opacity: 0;
		}
	}

	.animate-ping {
		animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
	}
</style>
